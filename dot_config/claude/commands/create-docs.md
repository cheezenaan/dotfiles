# Create docs

セッション内のやり取りや作業から、仕様や計画情報を抽出して構造化されたドキュメントを生成します。

## 使用方法

```bash
/create-docs [description]
```

- `description`: (optional) ドキュメントの識別名（ファイル名に使用）
  - 指定しない場合、セッション内のコアとなる概念から自動推測

## 実行処理

1. 出力先ディレクトリの決定
   - git プロジェクト: `$(git rev-parse --show-toplevel)/.tmp/docs/`
   - 非 git プロジェクト: `$(pwd)/.tmp/docs/`
2. ディレクトリが存在しない場合、`mkdir -p` で作成
3. 既存ファイルがある場合は内容をマージ（重複除去）
4. `~/.config/claude/templates/04.SPEC.md` テンプレートを使用
5. セッション内から以下の情報を抽出
   - やりたいこと（目的・ゴール）
   - 要望・要件（機能要件・非機能要件）
   - 受け入れ条件（完了判定基準）
   - 制約事項（技術的・時間的制約）
   - 仕様（実装詳細）
   - マイルストーン（段階的目標）
6. 必要に応じて Mermaid 図を自動生成
   - システム構成図
   - データフロー図
   - ER 図
7. `.tmp/docs/spec_<description>.md` として出力

## 出力先

- ディレクトリ: `.tmp/docs/`
- ファイル名形式: `spec_<description>.md`
- 例: `.tmp/docs/spec_user_authentication.md`

## 抽出ルール

### 情報の分類

- **決定事項**: ユーザーが明確に決定した内容、合意された仕様
- **検討中**: 議論中の内容、複数の選択肢がある項目
- **却下**: 検討したが採用されなかった案

### 抽出時の注意事項

- セッション内に該当する内容がない項目は無理に埋めない
- 推測や推察による補完は行わない（ハルシネーション防止）
- ユーザーの発言と AI の提案を区別して記録

### 差分更新時の重複判定

- 同一内容でもステータスが変更された場合は更新
  - 例: 「🔄 検討中」→「✅ 決定」
- 完全に同一の内容は除去
- タイムスタンプや議論の経緯は保持

## エラーハンドリング

- **description 自動推測失敗時**: デフォルト名 `spec_untitled.md` を使用
  - ファイル重複時は末尾に連番を付加（`spec_untitled_01.md`, `spec_untitled_02.md`）
- **git コマンド失敗時**: 現在のディレクトリ `$(pwd)` にフォールバック
- **テンプレート不在時**: エラーメッセージを表示して終了
- **書き込み権限不足時**: エラーメッセージを表示

## セキュリティ考慮事項

- description パラメータは英数字・ハイフン・アンダースコアのみ許可
- パストラバーサル攻撃を防ぐため、相対パスは禁止

## 使用例

```
/create-docs authentication_system
# → .tmp/docs/spec_authentication_system.md が生成される

/create-docs
# → セッション内容から "user_management" を推測
# → .tmp/docs/spec_user_management.md が生成される
# → 推測失敗時は .tmp/docs/spec_untitled.md が生成される
```